# API Contract: Todo Application Phase 2

## Overview
This document defines the API contracts for the Phase 2 full-stack todo application, specifying endpoints, request/response formats, and error handling.

## Base URL
`http://localhost:8000/api/v1` (development)
`https://api.todoapp.com/v1` (production)

## Authentication
All protected endpoints require a valid JWT token in the Authorization header:
```
Authorization: Bearer {jwt_token}
```

## Common Response Format

Success responses follow this structure:
```json
{
  "success": true,
  "data": { ... },
  "message": "Optional success message"
}
```

Error responses follow this structure:
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error message",
    "details": "Optional detailed error information"
  }
}
```

## Endpoints

### Authentication

#### POST /auth/login
Authenticate user and return JWT token

Request:
```json
{
  "username": "string (3-30 chars)",
  "password": "string (min 8 chars)"
}
```

Response (200 OK):
```json
{
  "success": true,
  "data": {
    "access_token": "jwt_token_string",
    "token_type": "bearer",
    "user": {
      "id": "user_id",
      "username": "username",
      "email": "user@example.com"
    }
  },
  "message": "Login successful"
}
```

Errors:
- 401: Invalid credentials
- 422: Validation error

#### POST /auth/register
Register a new user

Request:
```json
{
  "username": "string (3-30 chars)",
  "email": "valid email string",
  "password": "string (min 8 chars)"
}
```

Response (201 Created):
```json
{
  "success": true,
  "data": {
    "id": "user_id",
    "username": "username",
    "email": "user@example.com",
    "created_at": "ISO datetime"
  },
  "message": "Registration successful"
}
```

Errors:
- 400: Username or email already registered
- 422: Validation error

#### GET /auth/me
Get current user information

Response (200 OK):
```json
{
  "success": true,
  "data": {
    "id": "user_id",
    "username": "username",
    "email": "user@example.com",
    "is_active": true,
    "created_at": "ISO datetime",
    "updated_at": "ISO datetime",
    "preferences": {}
  }
}
```

Errors:
- 401: Unauthorized (invalid/expired token)

### Tasks

#### GET /tasks
Retrieve tasks with optional filtering and pagination

Query Parameters:
- `status`: Filter by task status ('active', 'completed')
- `priority`: Filter by priority ('high', 'medium', 'low')
- `tag`: Filter by tag ID
- `search`: Search in title/description
- `sort`: Sort by ('created_at', 'due_date', 'priority') + ('asc', 'desc')
- `page`: Page number (default: 1)
- `limit`: Items per page (default: 20, max: 100)

Response (200 OK):
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "task_id",
        "title": "Task title",
        "description": "Optional description",
        "status": "active",
        "priority": "high",
        "due_date": "ISO datetime or null",
        "created_at": "ISO datetime",
        "updated_at": "ISO datetime",
        "completed_at": "ISO datetime or null",
        "user_id": "user_id",
        "recurrence_pattern_id": "pattern_id or null",
        "tags": ["tag_id1", "tag_id2"]
      }
    ],
    "total": 150,
    "page": 1,
    "limit": 20,
    "has_more": true
  }
}
```

#### POST /tasks
Create a new task

Request:
```json
{
  "title": "Task title (1-100 chars)",
  "description": "Optional description (max 500 chars)",
  "priority": "high|medium|low",
  "due_date": "ISO datetime or null",
  "tags": ["tag_id1", "tag_id2"],
  "recurrence_pattern_id": "pattern_id or null"
}
```

Response (201 Created):
```json
{
  "success": true,
  "data": {
    "id": "new_task_id",
    "title": "Task title",
    "description": "Optional description",
    "status": "active",
    "priority": "high",
    "due_date": "ISO datetime or null",
    "created_at": "ISO datetime",
    "updated_at": "ISO datetime",
    "completed_at": null,
    "user_id": "current_user_id",
    "recurrence_pattern_id": "pattern_id or null",
    "tags": ["tag_id1", "tag_id2"]
  },
  "message": "Task created successfully"
}
```

Errors:
- 422: Validation error

#### GET /tasks/{id}
Get a specific task

Response (200 OK):
```json
{
  "success": true,
  "data": {
    "id": "task_id",
    "title": "Task title",
    "description": "Optional description",
    "status": "active",
    "priority": "high",
    "due_date": "ISO datetime or null",
    "created_at": "ISO datetime",
    "updated_at": "ISO datetime",
    "completed_at": "ISO datetime or null",
    "user_id": "user_id",
    "recurrence_pattern_id": "pattern_id or null",
    "tags": ["tag_id1", "tag_id2"]
  }
}
```

Errors:
- 404: Task not found
- 403: Task doesn't belong to current user

#### PUT /tasks/{id}
Update a specific task

Request:
```json
{
  "title": "Task title (1-100 chars)",
  "description": "Optional description (max 500 chars)",
  "status": "active|completed",
  "priority": "high|medium|low",
  "due_date": "ISO datetime or null",
  "tags": ["tag_id1", "tag_id2"],
  "recurrence_pattern_id": "pattern_id or null"
}
```

Response (200 OK):
```json
{
  "success": true,
  "data": {
    "id": "task_id",
    "title": "Updated task title",
    "description": "Updated description",
    "status": "active",
    "priority": "high",
    "due_date": "ISO datetime or null",
    "created_at": "Original datetime",
    "updated_at": "Current datetime",
    "completed_at": null,
    "user_id": "user_id",
    "recurrence_pattern_id": "pattern_id or null",
    "tags": ["tag_id1", "tag_id2"]
  },
  "message": "Task updated successfully"
}
```

#### DELETE /tasks/{id}
Delete a specific task

Response (200 OK):
```json
{
  "success": true,
  "message": "Task deleted successfully"
}
```

### Tags

#### GET /tags
Get all tags for the current user

Response (200 OK):
```json
{
  "success": true,
  "data": [
    {
      "id": "tag_id",
      "name": "Tag name",
      "color": "#FF5733",
      "user_id": "user_id",
      "created_at": "ISO datetime"
    }
  ]
}
```

#### POST /tags
Create a new tag

Request:
```json
{
  "name": "Tag name (1-50 chars)",
  "color": "Hex color code (e.g., #FF5733)"
}
```

Response (201 Created):
```json
{
  "success": true,
  "data": {
    "id": "new_tag_id",
    "name": "Tag name",
    "color": "#FF5733",
    "user_id": "current_user_id",
    "created_at": "ISO datetime"
  },
  "message": "Tag created successfully"
}
```

#### PUT /tags/{id}
Update a specific tag

Request:
```json
{
  "name": "Updated tag name (1-50 chars)",
  "color": "New hex color code"
}
```

Response (200 OK):
```json
{
  "success": true,
  "data": {
    "id": "tag_id",
    "name": "Updated tag name",
    "color": "New hex color code",
    "user_id": "user_id",
    "created_at": "Original datetime",
    "updated_at": "Current datetime"
  },
  "message": "Tag updated successfully"
}
```

#### DELETE /tags/{id}
Delete a specific tag

Response (200 OK):
```json
{
  "success": true,
  "message": "Tag deleted successfully"
}
```

### Recurrence Patterns

#### POST /recurring-patterns
Create a new recurrence pattern

Request:
```json
{
  "pattern_type": "daily|weekly|monthly|yearly",
  "interval": 1, // Positive integer
  "end_condition": "never|after_occurrences|on_date",
  "occurrence_count": 5, // Required if end_condition is "after_occurrences"
  "end_date": "ISO datetime", // Required if end_condition is "on_date"
  "days_of_week": "mon,tue,fri", // Optional, for weekly patterns
  "days_of_month": "1,15" // Optional, for monthly patterns
}
```

Response (201 Created):
```json
{
  "success": true,
  "data": {
    "id": "new_pattern_id",
    "pattern_type": "weekly",
    "interval": 1,
    "end_condition": "after_occurrences",
    "occurrence_count": 5,
    "end_date": null,
    "days_of_week": "mon,tue,fri",
    "days_of_month": null,
    "created_at": "ISO datetime",
    "updated_at": "ISO datetime"
  },
  "message": "Recurrence pattern created successfully"
}
```

## Error Codes

- `AUTH_001`: Invalid credentials
- `AUTH_002`: Token expired
- `AUTH_003`: Insufficient permissions
- `VALIDATION_001`: Validation error
- `RESOURCE_001`: Resource not found
- `RESOURCE_002`: Resource already exists
- `SYSTEM_001`: Internal server error